!function(e){e.fn.TrickyInfiniteScroll=function(t){var o={ParentProductsWrapper:null,IsRequestOn:!1,NextPageLink:null,PreviousPageLink:null,InitialNextPageLink:null,NeedToLoadOnlyNextPages:!1,NeedToLoadOnlyPreviousPages:!1,NeedToLoadBothPreviousAndNextPages:!1,UrlToLoad:null,UpdateHashOnWindowScrollLoaded:!1,Opts:{Selectors:{ParentProductsWrapper:".collection-matrix",Product:"li",NextPageLink:"#NextPaginationLink a",PreviousPageLink:"#PreviousPaginationLink a"},PageQueryStringKey:"page",WaitForImagesToBeLoaded:!1,EnableHasherModule:!1,CallBack:function(){},CallBackOnPageLoad:function(){},CallBackBeforePageLoad:function(){}}};o.Opts=e.extend(o.Opts,t),o.ParentProductsWrapper=this,o.NextPageLink=e(o.Opts.Selectors.NextPageLink),o.InitialNextPageLink=o.NextPageLink,o.PreviousPageLink=e(o.Opts.Selectors.PreviousPageLink),o.NeedToLoadOnlyNextPages=0==o.PreviousPageLink.length&&1==o.NextPageLink.length,o.NeedToLoadOnlyPreviousPages=1==o.PreviousPageLink.length&&0==o.NextPageLink.length,o.NeedToLoadBothPreviousAndNextPages=1==o.PreviousPageLink.length&&1==o.NextPageLink.length,o.UpdateHashOnWindowScrollLoaded=!1;var a,n=function(){if(null!=o.NextPageLink&&1==o.NextPageLink.length||null!=o.PreviousPageLink&&1==o.PreviousPageLink.length){var t=e(window).scrollTop()+e(window).height(),a=(e(o.Opts.Selectors.Product+":visible:last",o.ParentProductsWrapper).length?e(o.Opts.Selectors.Product+":visible:last",o.ParentProductsWrapper).offset().top:e(o.Opts.Selectors.Product+":last",o.ParentProductsWrapper).offset().top)+e(o.Opts.Selectors.Product+":visible:last",o.ParentProductsWrapper).height();!o.IsRequestOn&&a<=t&&(o.Opts.CallBackBeforePageLoad(),r.SetUpUrlToLoad(),e.get(o.UrlToLoad,i),o.IsRequestOn=!0)}else o.Opts.CallBack(),e(window).unbind("scroll.trickyInfiniteScroll")},i=function(t){var a=e(t).find(o.Opts.Selectors.ParentProductsWrapper);if(o.NextPageLink=e(t).find(o.Opts.Selectors.NextPageLink),o.PreviousPageLink=e(t).find(o.Opts.Selectors.PreviousPageLink),o.Opts.WaitForImagesToBeLoaded){var n=e("img",a).length,i=1,s=!1;e("img",a).load(function(){++i>=n&&o.IsRequestOn&&!s&&(r.FireAllCallBacks(a),s=!0)}).each(function(){this.complete&&e(this).load()})}else r.FireAllCallBacks(a);o.Opts.EnableHasherModule&&!o.UpdateHashOnWindowScrollLoaded&&(o.UpdateHashOnWindowScrollLoaded=!0,l.UpdateHashOnWindowScrollStopped())},r={FireAllCallBacks:function(e){o.Opts.EnableHasherModule&&l.HashUrlAndAddPageAttributesToProducts(e),o.ParentProductsWrapper.append(e.html()),r.ReloadPageLinksObjectsAndVariables(),o.Opts.CallBackOnPageLoad(),o.IsRequestOn=!1},AddPageNumberAttributesToExistingProducts:function(){var t=r.GetParameterByName(window.location.href,o.Opts.PageQueryStringKey);e(o.Opts.Selectors.Product,o.ParentProductsWrapper).attr("data-pagenumber",""==t?1:t)},GetParameterByName:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null==o?"":decodeURIComponent(o[1].replace(/\+/g," "))},ReloadPageLinksObjectsAndVariables:function(){o.NeedToLoadOnlyNextPages&&0==o.NextPageLink.length&&(o.NeedToLoadOnlyNextPages=!1,o.PreviousPageLink=o.NextPageLink=null),o.NeedToLoadOnlyPreviousPages&&0==o.PreviousPageLink.length&&(o.NeedToLoadOnlyPreviousPages=!1,o.NextPageLink=o.PreviousPageLink=null)},SetUpUrlToLoad:function(){o.NeedToLoadOnlyPreviousPages&&(o.UrlToLoad=o.PreviousPageLink.attr("href")),o.NeedToLoadOnlyNextPages&&(o.UrlToLoad=o.NextPageLink.attr("href")),o.NeedToLoadBothPreviousAndNextPages&&(o.PreviousPageLink.length?o.UrlToLoad=o.PreviousPageLink.attr("href"):null!=o.InitialNextPageLink&&(o.UrlToLoad=o.InitialNextPageLink.attr("href"),o.NeedToLoadOnlyNextPages=!0,o.NeedToLoadBothPreviousAndNextPages=!1))}},l={CheckHashAndReloadPageIfNeeded:function(){var e=window.location.hash;if(e&&-1!=e.indexOf(o.Opts.PageQueryStringKey)){var t=e.split("=")[1],a=window.location.href.replace(e,""),n=window.location.search;if(""==n)window.location.href=a+"?"+o.Opts.PageQueryStringKey+"="+t;else{for(var i=n.replace("?","").split("&"),r="",l=0;l<i.length;l++)-1==i[l].indexOf(o.Opts.PageQueryStringKey+"=")&&(r+=i[l]+"&");a=window.location.href.replace(window.location.hash,"").replace(window.location.search,"");a=""!=r?a+"?"+r+o.Opts.PageQueryStringKey+"="+t:a+"?"+o.Opts.PageQueryStringKey+"="+t,window.location.href=a}}},HashUrlAndAddPageAttributesToProducts:function(t){var a=r.GetParameterByName(o.UrlToLoad,o.Opts.PageQueryStringKey);a&&(e(o.Opts.Selectors.Product,t).attr("data-pagenumber",a),window.location.hash=o.Opts.PageQueryStringKey+"="+a)},UpdateHashOnWindowScrollStopped:function(){e(window).scrollStopped(function(){e(o.Opts.Selectors.Product,o.ParentProductsWrapper).each(function(){e(this).visible(!0)?(e(this).addClass("in-viewport"),e(this).removeClass("not-in-viewport")):(e(this).removeClass("in-viewport"),e(this).addClass("not-in-viewport"))});var t=e(o.Opts.Selectors.Product+".in-viewport",o.ParentProductsWrapper).first();1==t.length&&(window.location.hash=o.Opts.PageQueryStringKey+"="+t.attr("data-pagenumber"))})}};o.Opts.EnableHasherModule&&l.CheckHashAndReloadPageIfNeeded(),r.AddPageNumberAttributesToExistingProducts(),e(window).bind("scroll.trickyInfiniteScroll",n),e(window).resize(function(){a&&clearTimeout(a),a=setTimeout(function(){e(window).unbind("scroll.trickyInfiniteScroll"),e(window).bind("scroll.trickyInfiniteScroll",n)},1e3)})}}(jQuery),function(e){e.fn.scrollStopped=function(t){e(this).scroll(function(){var o=this,a=e(o);a.data("scrollTimeout")&&clearTimeout(a.data("scrollTimeout")),a.data("scrollTimeout",setTimeout(t,250,o))})}}(jQuery),function(e){var t=e(window);e.fn.visible=function(e,o,a){if(!(this.length<1)){var n=this.length>1?this.eq(0):this,i=n.get(0),r=t.width(),l=t.height(),a=a||"both",s=!0!==o||i.offsetWidth*i.offsetHeight;if("function"==typeof i.getBoundingClientRect){var d=i.getBoundingClientRect(),P=d.top>=0&&d.top<l,c=d.bottom>0&&d.bottom<=l,u=d.left>=0&&d.left<r,g=d.right>0&&d.right<=r,p=e?P||c:P&&c,h=e?u||g:u&&g;if("both"===a)return s&&p&&h;if("vertical"===a)return s&&p;if("horizontal"===a)return s&&h}else{var f=t.scrollTop(),L=f+l,O=t.scrollLeft(),v=O+r,k=n.offset(),w=k.top,N=w+n.height(),y=k.left,S=y+n.width(),T=!0===e?N:w,x=!0===e?w:N,b=!0===e?S:y,m=!0===e?y:S;if("both"===a)return!!s&&L>=x&&T>=f&&v>=m&&b>=O;if("vertical"===a)return!!s&&L>=x&&T>=f;if("horizontal"===a)return!!s&&v>=m&&b>=O}}}}(jQuery);